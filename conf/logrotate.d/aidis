# AIDIS Log Rotation Configuration
# Location: /home/ridgetop/aidis/conf/logrotate.d/aidis
# 
# This configuration manages log rotation for all AIDIS services
# Prevents disk space issues with automatic compression and cleanup

# Main AIDIS service logs
/home/ridgetop/aidis/logs/aidis.log
/home/ridgetop/aidis/logs/aidis-core.log
/home/ridgetop/aidis/logs/http-bridge.log
/home/ridgetop/aidis/logs/http-mcp-bridge.log
/home/ridgetop/aidis/logs/mcp-proxy.log {
    # Rotate when files reach 50MB or daily, whichever comes first
    size 50M
    daily
    
    # Keep 30 rotated files (about 1 month of logs)
    rotate 30
    
    # Compress rotated logs to save space
    compress
    
    # Delay compression by 1 rotation (current + 1 uncompressed)
    delaycompress
    
    # Don't rotate if log file is empty
    notifempty
    
    # Create new log files with specific permissions
    create 0644 ridgetop ridgetop
    
    # Don't error if log file doesn't exist
    missingok
    
    # Copy and truncate instead of moving (safer for running services)
    copytruncate
    
    # Use date as extension instead of numbers
    dateext
    dateformat _%Y%m%d_%H%M%S
    
    # Move rotated logs to archive directory
    olddir /home/ridgetop/aidis/logs/archive
    createolddir 0755 ridgetop ridgetop
}

# Service-specific logs with higher rotation frequency
/home/ridgetop/aidis/logs/metrics/*.log {
    size 25M
    hourly
    rotate 168  # 1 week of hourly logs
    compress
    delaycompress
    notifempty
    create 0644 ridgetop ridgetop
    missingok
    copytruncate
    dateext
    dateformat _%Y%m%d_%H%M%S
    olddir /home/ridgetop/aidis/logs/archive/metrics
    createolddir 0755 ridgetop ridgetop
}

# Pattern detection logs - high volume
/home/ridgetop/aidis/logs/patterns/*.log {
    size 25M
    hourly
    rotate 168  # 1 week of hourly logs
    compress
    delaycompress
    notifempty
    create 0644 ridgetop ridgetop
    missingok
    copytruncate
    dateext
    dateformat _%Y%m%d_%H%M%S
    olddir /home/ridgetop/aidis/logs/archive/patterns
    createolddir 0755 ridgetop ridgetop
}

# Complexity analysis logs
/home/ridgetop/aidis/logs/complexity/*.log {
    size 25M
    daily
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 ridgetop ridgetop
    missingok
    copytruncate
    dateext
    dateformat _%Y%m%d_%H%M%S
    olddir /home/ridgetop/aidis/logs/archive/complexity
    createolddir 0755 ridgetop ridgetop
}

# Git tracking logs
/home/ridgetop/aidis/logs/git-tracking/*.log {
    size 10M
    daily
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 ridgetop ridgetop
    missingok
    copytruncate
    dateext
    dateformat _%Y%m%d_%H%M%S
    olddir /home/ridgetop/aidis/logs/archive/git-tracking
    createolddir 0755 ridgetop ridgetop
}

# System logs and performance
/home/ridgetop/aidis/logs/system/*.log {
    size 25M
    daily
    rotate 14  # 2 weeks
    compress
    delaycompress
    notifempty
    create 0644 ridgetop ridgetop
    missingok
    copytruncate
    dateext
    dateformat _%Y%m%d_%H%M%S
    olddir /home/ridgetop/aidis/logs/archive/system
    createolddir 0755 ridgetop ridgetop
}

# Error logs - kept longer for debugging
/home/ridgetop/aidis/logs/errors/*.log {
    size 10M
    daily
    rotate 90  # 3 months
    compress
    delaycompress
    notifempty
    create 0644 ridgetop ridgetop
    missingok
    copytruncate
    dateext
    dateformat _%Y%m%d_%H%M%S
    olddir /home/ridgetop/aidis/logs/archive/errors
    createolddir 0755 ridgetop ridgetop
}
